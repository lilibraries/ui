import { Meta, Canvas, Story } from "@storybook/addon-docs";

<Meta title="Overlays/Popper" />

# Popper

Popper is built on [floating-ui](https://floating-ui.com/), and it's the base component of popup components in this library, like Tooltip, Popup. You can build your own popup components based on this component.

## Examples

### Basic

<Canvas mdxSource={require("!!raw-loader!./Basic").default}>
  <Story id="examples-popper--basic" />
</Canvas>

### Arrow

<Canvas mdxSource={require("!!raw-loader!./Arrow").default}>
  <Story id="examples-popper--arrow" />
</Canvas>

### Events

<Canvas mdxSource={require("!!raw-loader!./Events").default}>
  <Story id="examples-popper--events" />
</Canvas>

### Right click

<Canvas mdxSource={require("!!raw-loader!./RightClick").default}>
  <Story id="examples-popper--right-click" />
</Canvas>

### Hover move

<Canvas mdxSource={require("!!raw-loader!./HoverMove").default}>
  <Story id="examples-popper--hover-move" />
</Canvas>

### Placements

<Canvas mdxSource={require("!!raw-loader!./Placements").default}>
  <Story id="examples-popper--placements" />
</Canvas>

### Nested

<Canvas mdxSource={require("!!raw-loader!./Nested").default}>
  <Story id="examples-popper--nested" />
</Canvas>

### Inline

<Canvas mdxSource={require("!!raw-loader!./Inline").default}>
  <Story id="examples-popper--inline" />
</Canvas>

### Text selection

<Canvas mdxSource={require("!!raw-loader!./TextSelection").default}>
  <Story id="examples-popper--text-selection" />
</Canvas>

## Props

| Property               | Type                                                                                                                                                                                       | Description                                                                                                                                                                    |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `content`              | `ReactNode`                                                                                                                                                                                | Popup content                                                                                                                                                                  |
| `children`             | `ReactElement` \| [`() => PopperVirtualElement`](#poppervirtualelement)                                                                                                                    | A react element (must reference to a DOM element) or a function returns a virtual element                                                                                      |
| `arrow`                | `ReactElement`                                                                                                                                                                             | Arrow element                                                                                                                                                                  |
| `container`            | [`EffectTarget<HTMLElement>`](https://lilibraries.github.io/utils/types#effecttarget-react)                                                                                                | Parent node of popup layer. It can be `null`, `undefined`, a DOM element, a function returns a DOM element or a ref object refrences a DOM element. Default is `document.body` |
| `on`                   | `"click"` \| `"hover"` \| `"focus"` \| `"contextmenu"` \| `string[]`                                                                                                                       | Trigger event, default is `"click"`                                                                                                                                            |
| `offset`               | `number` \| `[number, number]`                                                                                                                                                             | Offset distance between popup layer and trigger element                                                                                                                        |
| `arrowPadding`         | `number`                                                                                                                                                                                   | Arrow padding                                                                                                                                                                  |
| `strategy`             | `"absolute"` \| `"fixed"`                                                                                                                                                                  | Popup strategy, default is `"fixed"`                                                                                                                                           |
| `placement`            | `"top"` \| `"top-start"` \| `"top-end"` \| `"right"` \| `"right-start"` \| `"right-end"` \| `"bottom"` \| `"bottom-start"` \| `"bottom-end"` \| `"left"` \| `"left-start"` \| `"left-end"` | Popup placement, default is `"bottom"`                                                                                                                                         |
| `open`                 | `boolean`                                                                                                                                                                                  | Show popup layer                                                                                                                                                               |
| `defaultOpen`          | `boolean`                                                                                                                                                                                  | Uncontrolled open                                                                                                                                                              |
| `openDelay`            | `number`                                                                                                                                                                                   | Delay time on open, in milliseconds                                                                                                                                            |
| `closeDelay`           | `number`                                                                                                                                                                                   | Delay time on close, in milliseconds                                                                                                                                           |
| `hoverEnterDelay`      | `number`                                                                                                                                                                                   | Delay time on hover enter, in milliseconds, default is 100                                                                                                                     |
| `hoverLeaveDelay`      | `number`                                                                                                                                                                                   | Delay time on hover leave, in milliseconds, default is 100                                                                                                                     |
| `updateDeps`           | `any[]`                                                                                                                                                                                    | A dependency array to auto update popup position                                                                                                                               |
| `followPoint`          | `boolean`                                                                                                                                                                                  | The popup layer will follow the mouse point                                                                                                                                    |
| `mountOnInit`          | `boolean`                                                                                                                                                                                  | Mount on first time, no matter whether the component is opened                                                                                                                 |
| `unmountOnClose`       | `boolean`                                                                                                                                                                                  | Unmount popup content on close                                                                                                                                                 |
| `closeOnEscape`        | `boolean`                                                                                                                                                                                  | Close when pressing the <kbd>ESC</kbd> key                                                                                                                                     |
| `closeOnWindowBlur`    | `boolean`                                                                                                                                                                                  | Close when the `window` loses focus                                                                                                                                            |
| `closeOnDocumentClick` | `boolean`                                                                                                                                                                                  | Close when clicking document, default is `true`                                                                                                                                |
| `onOpen`               | `() => void`                                                                                                                                                                               | Open event                                                                                                                                                                     |
| `onClose`              | `() => void`                                                                                                                                                                               | Close event                                                                                                                                                                    |
| `onUpdate`             | [`(data: PopperUpdateData) => void`](#popperupdatedata)                                                                                                                                    | Update event of popup layer position changing. It's useful when you build your own popup component based on the Popper component                                               |

### PopperVirtualElement

A popper virtual element is an object contains a function named [`getBoundingClientRect()`](https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect).

```ts
interface PopperVirtualElement {
  getBoundingClientRect(): {
    width: number;
    height: number;
    x: number;
    y: number;
    top: number;
    left: number;
    right: number;
    bottom: number;
  };
}
```

For how to use it, please see the [text selection](#text-selection) example above.

### PopperUpdateData

```ts
interface PopperData {
  // The x coordinate of popup layer.
  x: number;
  // The y coordinate of popup layer.
  y: number;
  // The x coordinate of arrow element, if it exists.
  arrowX?: number;
  // The y coordinate of arrow element, if it exists.
  arrowY?: number;
  // Popup strategy.
  strategy: "fixed" | "absolute";
  // Actual placement. May be inconsistent with the passed property.
  placement:
    | "top"
    | "top-start"
    | "top-end"
    | "right"
    | "right-start"
    | "right-end"
    | "bottom"
    | "bottom-start"
    | "bottom-end"
    | "left"
    | "left-start"
    | "left-end";
}
```
