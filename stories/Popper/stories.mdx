import { Canvas, Meta, Story } from "@storybook/addon-docs";

<Meta title="Overlays/Popper" />

# Popper

Popper is built on [floating-ui](https://floating-ui.com/), and it's the base component of pop-up components in this library, such as Popup, Tooltip, Confirm, Dropdown. You can build your own pop-up components based on this component.

## Examples

### Basic

<Canvas mdxSource={require("!!raw-loader!./BasicPopper").default}>
  <Story id="examples-popper--basic-popper" />
</Canvas>

### Show Arrow

<Canvas mdxSource={require("!!raw-loader!./ArrowedPopper").default}>
  <Story id="examples-popper--arrowed-popper" />
</Canvas>

### Trigger Events

<Canvas mdxSource={require("!!raw-loader!./TriggerEvents").default}>
  <Story id="examples-popper--trigger-events" />
</Canvas>

### Close Events

<Canvas mdxSource={require("!!raw-loader!./CloseEvents").default}>
  <Story id="examples-popper--close-events" />
</Canvas>

### Controlled Open

<Canvas mdxSource={require("!!raw-loader!./ControlledOpen").default}>
  <Story id="examples-popper--controlled-open" />
</Canvas>

### Trigger Delay

Click to show or hide after 500ms.

<Canvas mdxSource={require("!!raw-loader!./TriggerDelay").default}>
  <Story id="examples-popper--trigger-delay" />
</Canvas>

### Placements

<Canvas mdxSource={require("!!raw-loader!./Placements").default}>
  <Story id="examples-popper--placements" />
</Canvas>

### Right Click

<Canvas mdxSource={require("!!raw-loader!./RightClick").default}>
  <Story id="examples-popper--right-click" />
</Canvas>

### Hover Move

<Canvas mdxSource={require("!!raw-loader!./HoverMove").default}>
  <Story id="examples-popper--hover-move" />
</Canvas>

### Inline Trigger

<Canvas mdxSource={require("!!raw-loader!./InlineTrigger").default}>
  <Story id="examples-popper--inline-trigger" />
</Canvas>

### Text Selection

<Canvas mdxSource={require("!!raw-loader!./TextSelection").default}>
  <Story id="examples-popper--text-selection" />
</Canvas>

### Nested Popper

<Canvas mdxSource={require("!!raw-loader!./NestedPopper").default}>
  <Story id="examples-popper--nested-popper" />
</Canvas>

## API

### Popper

| Property          | Type                                                                                                                                                                                       | Description                                                                                                                                                                                                                                                                                                |
| ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `children`        | `string` \| `number` \| `ReactElement` \| [`() => PopperVirtualElement`](#poppervirtualelement)                                                                                            | Trigger element, it should be string, number, a react element (must reference to a DOM element) or a function returns a virtual element.                                                                                                                                                                   |
| `arrow`           | `ReactElement`                                                                                                                                                                             | Arrow element, must reference to a DOM element.                                                                                                                                                                                                                                                            |
| `arrowPadding`    | `number`                                                                                                                                                                                   | Min padding space between arrow element and popup layer edge.                                                                                                                                                                                                                                              |
| `content`         | `ReactNode`                                                                                                                                                                                | Popup content.                                                                                                                                                                                                                                                                                             |
| `on`              | `"click"` \| `"hover"` \| `"focus"` \| `"context-menu"` \| `string[]`                                                                                                                      | Trigger event, default is `"click"`.                                                                                                                                                                                                                                                                       |
| `off`             | `"escape"` \| `"page-hide"` \| `"window-blur"` \| `"document-click"` \| `string[]`                                                                                                         | Close event. Default is `"document-click"`.                                                                                                                                                                                                                                                                |
| `offset`          | `number` \| `{ main?: number; cross?: number }`                                                                                                                                            | Offset distance between popup layer and trigger element. If this property is specified as a number, it is equivalent to setting both the main and cross axes.                                                                                                                                              |
| `strategy`        | `"absolute"` \| `"fixed"`                                                                                                                                                                  | Popup strategy, default is `"absolute"`.                                                                                                                                                                                                                                                                   |
| `placement`       | `"top"` \| `"top-start"` \| `"top-end"` \| `"right"` \| `"right-start"` \| `"right-end"` \| `"bottom"` \| `"bottom-start"` \| `"bottom-end"` \| `"left"` \| `"left-start"` \| `"left-end"` | Popup placement, default is `"bottom"`.                                                                                                                                                                                                                                                                    |
| `container`       | [`EffectTarget<HTMLElement>`](https://lilibraries.github.io/utils/types#effecttarget-react)                                                                                                | The DOM node where the component should be rendered. It can be `null`, `undefined`, a DOM element, a function returns a DOM element or a ref object references a DOM element. Default is `document.body`. This prop can be configured by [`Portal.Config`](?path=/story/others-portal--page#portalconfig). |
| `open`            | `boolean`                                                                                                                                                                                  | Show popup layer.                                                                                                                                                                                                                                                                                          |
| `defaultOpen`     | `boolean`                                                                                                                                                                                  | Uncontrolled open.                                                                                                                                                                                                                                                                                         |
| `openDelay`       | `number`                                                                                                                                                                                   | Delay time on open, in milliseconds.                                                                                                                                                                                                                                                                       |
| `closeDelay`      | `number`                                                                                                                                                                                   | Delay time on close, in milliseconds.                                                                                                                                                                                                                                                                      |
| `hoverEnterDelay` | `number`                                                                                                                                                                                   | Delay time on hover enter, in milliseconds, default is `100`.                                                                                                                                                                                                                                              |
| `hoverLeaveDelay` | `number`                                                                                                                                                                                   | Delay time on hover leave, in milliseconds, default is `100`.                                                                                                                                                                                                                                              |
| `firstMount`      | `boolean`                                                                                                                                                                                  | Mount on first time, no matter whether the component is opened.                                                                                                                                                                                                                                            |
| `keepMounted`     | `boolean`                                                                                                                                                                                  | Keep mounted after the component is closed.                                                                                                                                                                                                                                                                |
| `updateDeps`      | `any[]`                                                                                                                                                                                    | A dependency array to auto update popup position.                                                                                                                                                                                                                                                          |
| `followPointer`   | `boolean`                                                                                                                                                                                  | The popup layer will follow the mouse pointer.                                                                                                                                                                                                                                                             |
| `render`          | `(popper: ReactElement) => ReactElement`                                                                                                                                                   | Custom popper layer render.                                                                                                                                                                                                                                                                                |
| `onOpen`          | `() => void`                                                                                                                                                                               | Open event handler.                                                                                                                                                                                                                                                                                        |
| `onClose`         | `() => void`                                                                                                                                                                               | Close event handler.                                                                                                                                                                                                                                                                                       |
| `onOpened`        | `() => void`                                                                                                                                                                               | Opened event handler.                                                                                                                                                                                                                                                                                      |
| `onClosed`        | `() => void`                                                                                                                                                                               | Closed event handler.                                                                                                                                                                                                                                                                                      |
| `onUpdate`        | [`(data: PopperUpdateData) => void`](#popperupdatedata)                                                                                                                                    | Update event of the popup layer position changing. It's useful when you build your own popup component based on the Popper component.                                                                                                                                                                      |

It accepts all props which the native `<div>` element supports.

### PopperVirtualElement

A popper virtual element is an object contains a function named [`getBoundingClientRect()`](https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect).

```ts
interface PopperVirtualElement {
  getBoundingClientRect(): {
    width: number;
    height: number;
    x: number;
    y: number;
    top: number;
    left: number;
    right: number;
    bottom: number;
  };
}
```

For how to use it, please see the [text selection](#text-selection) example above.

### PopperUpdateData

```ts
interface PopperData {
  // The x coordinate of popup layer.
  x: number;
  // The y coordinate of popup layer.
  y: number;
  // The x coordinate of arrow element, if it exists.
  arrowX?: number;
  // The y coordinate of arrow element, if it exists.
  arrowY?: number;
  // Popup strategy.
  strategy: "fixed" | "absolute";
  // Actual placement. May be inconsistent with the passed property.
  placement:
    | "top"
    | "top-start"
    | "top-end"
    | "right"
    | "right-start"
    | "right-end"
    | "bottom"
    | "bottom-start"
    | "bottom-end"
    | "left"
    | "left-start"
    | "left-end";
}
```
