import { Meta, Canvas, Story } from "@storybook/addon-docs";

<Meta title="Overlays/Popper" />

# Popper

Popper is built on [floating-ui](https://floating-ui.com/), and it's the base component of popup components in this library, like Popup, Tooltip, Dropdown, etc. You can build your own popup components based on this component.

## Examples

### Basic

<Canvas mdxSource={require("!!raw-loader!./Basic").default}>
  <Story id="examples-popper--basic" />
</Canvas>

### Arrow

<Canvas mdxSource={require("!!raw-loader!./Arrow").default}>
  <Story id="examples-popper--arrow" />
</Canvas>

### Trigger Events

<Canvas mdxSource={require("!!raw-loader!./TriggerEvents").default}>
  <Story id="examples-popper--trigger-events" />
</Canvas>

### Close Events

Default to close when document is clicked.

<Canvas mdxSource={require("!!raw-loader!./CloseEvents").default}>
  <Story id="examples-popper--close-events" />
</Canvas>

### Controlled

<Canvas mdxSource={require("!!raw-loader!./Controlled").default}>
  <Story id="examples-popper--controlled" />
</Canvas>

### Trigger Delay

<Canvas mdxSource={require("!!raw-loader!./TriggerDelay").default}>
  <Story id="examples-popper--trigger-delay" />
</Canvas>

### Hover Delay

<Canvas mdxSource={require("!!raw-loader!./HoverDelay").default}>
  <Story id="examples-popper--hover-delay" />
</Canvas>

### Placements

<Canvas mdxSource={require("!!raw-loader!./Placements").default}>
  <Story id="examples-popper--placements" />
</Canvas>

### Right Click

<Canvas mdxSource={require("!!raw-loader!./RightClick").default}>
  <Story id="examples-popper--right-click" />
</Canvas>

### Hover Move

<Canvas mdxSource={require("!!raw-loader!./HoverMove").default}>
  <Story id="examples-popper--hover-move" />
</Canvas>

### Inline

<Canvas mdxSource={require("!!raw-loader!./Inline").default}>
  <Story id="examples-popper--inline" />
</Canvas>

### Text Selection

<Canvas mdxSource={require("!!raw-loader!./TextSelection").default}>
  <Story id="examples-popper--text-selection" />
</Canvas>

### Nested

The Popper can be nested by default.

<Canvas mdxSource={require("!!raw-loader!./Nested").default}>
  <Story id="examples-popper--nested" />
</Canvas>

## API

### Popper

| Property              | Type                                                                                                                                                                                       | Description                                                                                                                                                                                                                                                                     |
| --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `children`            | `ReactElement` \| [`() => PopperVirtualElement`](#poppervirtualelement)                                                                                                                    | Trigger element, it should be a react element (must reference to a DOM element) or a function returns a virtual element                                                                                                                                                         |
| `content`             | `ReactNode`                                                                                                                                                                                | Popup content                                                                                                                                                                                                                                                                   |
| `arrow`               | `ReactElement`                                                                                                                                                                             | Arrow element, must reference to a DOM element                                                                                                                                                                                                                                  |
| `arrowPadding`        | `number`                                                                                                                                                                                   | Min padding space between arrow element and popup layer edge                                                                                                                                                                                                                    |
| `on`                  | `"click"` \| `"hover"` \| `"focus"` \| `"contextmenu"` \| `string[]`                                                                                                                       | Trigger event, default is `"click"`                                                                                                                                                                                                                                             |
| `offset`              | `number` \| `[number, number]`                                                                                                                                                             | Offset distance between popup layer and trigger element. If a number is set, it will only effect the main axis. If an array is set, the first one effects main axis, and the second one effects cross axis.                                                                     |
| `strategy`            | `"absolute"` \| `"fixed"`                                                                                                                                                                  | Popup strategy, default is `"absolute"`                                                                                                                                                                                                                                         |
| `placement`           | `"top"` \| `"top-start"` \| `"top-end"` \| `"right"` \| `"right-start"` \| `"right-end"` \| `"bottom"` \| `"bottom-start"` \| `"bottom-end"` \| `"left"` \| `"left-start"` \| `"left-end"` | Popup placement, default is `"bottom"`                                                                                                                                                                                                                                          |
| `container`           | [`EffectTarget<HTMLElement>`](https://lilibraries.github.io/utils/types#effecttarget-react)                                                                                                | Parent node of popup layer. It can be `null`, `undefined`, a DOM element, a function returns a DOM element or a ref object refrences a DOM element. Default is `document.body`. This prop can be configured by [`Portal.Config`](?path=/story/others-portal--page#portalconfig) |
| `open`                | `boolean`                                                                                                                                                                                  | Show popup layer                                                                                                                                                                                                                                                                |
| `defaultOpen`         | `boolean`                                                                                                                                                                                  | Uncontrolled open                                                                                                                                                                                                                                                               |
| `openDelay`           | `number`                                                                                                                                                                                   | Delay time on open, in milliseconds                                                                                                                                                                                                                                             |
| `closeDelay`          | `number`                                                                                                                                                                                   | Delay time on close, in milliseconds                                                                                                                                                                                                                                            |
| `hoverEnterDelay`     | `number`                                                                                                                                                                                   | Delay time on hover enter, in milliseconds, default is `100`                                                                                                                                                                                                                    |
| `hoverLeaveDelay`     | `number`                                                                                                                                                                                   | Delay time on hover leave, in milliseconds, default is `100`                                                                                                                                                                                                                    |
| `updateDeps`          | `any[]`                                                                                                                                                                                    | A dependency array to auto update popup position                                                                                                                                                                                                                                |
| `followPoint`         | `boolean`                                                                                                                                                                                  | The popup layer will follow the mouse point                                                                                                                                                                                                                                     |
| `prepared`            | `boolean`                                                                                                                                                                                  | Mount on first time, no matter whether the component is opened                                                                                                                                                                                                                  |
| `keepAlive`           | `boolean`                                                                                                                                                                                  | Don't unmount popup content on close                                                                                                                                                                                                                                            |
| `closeOnEscape`       | `boolean`                                                                                                                                                                                  | Close when pressing the <kbd>ESC</kbd> key                                                                                                                                                                                                                                      |
| `closeOnPageHide`     | `boolean`                                                                                                                                                                                  | Close when the page is hidden                                                                                                                                                                                                                                                   |
| `closeOnWindowBlur`   | `boolean`                                                                                                                                                                                  | Close when the `window` loses focus                                                                                                                                                                                                                                             |
| `closeOnClickOutside` | `boolean`                                                                                                                                                                                  | Close when clicking outside the trigger and pupup layer, default is `true`                                                                                                                                                                                                      |
| `onOpen`              | `() => void`                                                                                                                                                                               | Event of the `open` state change to `true`                                                                                                                                                                                                                                      |
| `onClose`             | `() => void`                                                                                                                                                                               | Event of the `open` state change to `false`                                                                                                                                                                                                                                     |
| `onOpened`            | `() => void`                                                                                                                                                                               | Popup layer show event                                                                                                                                                                                                                                                          |
| `onClosed`            | `() => void`                                                                                                                                                                               | Popup layer hide event                                                                                                                                                                                                                                                          |
| `onUpdate`            | [`(data: PopperUpdateData) => void`](#popperupdatedata)                                                                                                                                    | Update event of popup layer position changing. It's useful when you build your own popup component based on the Popper component                                                                                                                                                |

It accepts all props which the native `<div>` element supports.

### PopperVirtualElement

A popper virtual element is an object contains a function named [`getBoundingClientRect()`](https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect).

```ts
interface PopperVirtualElement {
  getBoundingClientRect(): {
    width: number;
    height: number;
    x: number;
    y: number;
    top: number;
    left: number;
    right: number;
    bottom: number;
  };
}
```

For how to use it, please see the [text selection](#text-selection) example above.

### PopperUpdateData

```ts
interface PopperData {
  // The x coordinate of popup layer.
  x: number;
  // The y coordinate of popup layer.
  y: number;
  // The x coordinate of arrow element, if it exists.
  arrowX?: number;
  // The y coordinate of arrow element, if it exists.
  arrowY?: number;
  // Popup strategy.
  strategy: "fixed" | "absolute";
  // Actual placement. May be inconsistent with the passed property.
  placement:
    | "top"
    | "top-start"
    | "top-end"
    | "right"
    | "right-start"
    | "right-end"
    | "bottom"
    | "bottom-start"
    | "bottom-end"
    | "left"
    | "left-start"
    | "left-end";
}
```
